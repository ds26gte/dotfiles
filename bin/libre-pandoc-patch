# last modified 2014-09-08

# .docx files written from libreoffice don't have
# word/webSettings.xml, which trips pandoc when the latter uses
# such a file as a reference.docx. This script fixes that by
# adding a dummy webSettings.xml to ./reference.docx

if test ! -f reference.docx
then echo reference.docx not found; exit
fi

if test -n "$(unzip -l reference.docx|grep word/webSettings.xml|head -n 1)"
then echo reference.docx already has word/webSettings.xml; exit
fi

here=$(pwd)

tmpdir=$(mktemp -d -t pandoc.tmp.XXX)
rm -fr $tmpdir/*
cp -p reference.docx $tmpdir

cd $tmpdir
unzip -q reference.docx

cd word
cp -p settings.xml webSettings.xml
cd ..

rm reference.docx
zip -q -r reference.docx *

mv reference.docx $here
cd $here
rm -fr $tmpdir
