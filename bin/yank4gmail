# last modified 2019-09-07
# Dorai Sitaram

if test x$DISPLAY = x; then
  exit
fi

if test $# -ne 1; then
  echo Need one file arg; exit
fi

tmpf=~/tmp/.tmp.$$

cp -p $1 $tmpf

vi -es $tmpf <<EOF

set fo+=w

"remove all trailing spaces
sil! %s/\s\+$//

"add one trailing space for line starting with non-blank
g/^\S/ s/\S$/\0 /

"remove trailing space on last line of paragraph
g/^$/ -1s/\s\+$//

"at every non-blank line, reformat up to paragraph end
g/\s$/ norm vipJ

%s/\s\+$//

x

EOF

xclip -selection clipboard -i $tmpf

rm $tmpf
