# last modified 2014-10-18

if test $# -ne 2
then echo need 2 arguments; exit
elif test ! -f $1
then echo file $1 not found; exit
fi

sed -e '/^\.\s*::$/,/^\.\s*::$/ s/^/| /' \
    -e 's/^| \.\s*::$//' \
    -e 's/^\.\s*#\*$/### */' \
    -e 's/^\.\s*#%\s/# /' \
    -e 's/^\.\s*\(#\+\s\+\)/\1/' \
    -e 's/^\.\s*\(```\(\s*\S\+\)\?\)$/\1/' \
    -e 's/^:+:\s*\(\S\+\)$/\n[^\1]:/' \
    -e 's/^:+:$//' \
    $1 > $2
